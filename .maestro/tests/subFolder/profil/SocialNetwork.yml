appId: ${MAESTRO_APP_ID}
---
- scrollUntilVisible:
    element:
      text: 'Instagram'
- tapOn: 'Instagram'
- waitForAnimationToEnd

- runFlow: # Si 1ere ouverture de chrome
    when:
      visible: 'Accepter et continuer'
    commands:
      - tapOn: 'Accepter et continuer'
- runFlow:
    when:
      platform: Android
    commands:
      - assertVisible:
          id: 'com.android.chrome:id/url_bar'
      - runFlow:
          file: ../../subFolder/cloud/commands/TapOnBack.yml

- runFlow:
    when:
      platform: iOS
    commands:
      - tapOn: 'Revenir à pass Culture S'
      - scrollUntilVisible:
          element:
            text: 'Instagram'

- tapOn: 'X'
- waitForAnimationToEnd
- runFlow:
    when:
      platform: Android
    commands:
      - assertVisible:
          id: 'com.android.chrome:id/url_bar'
      - runFlow:
          file: ../../subFolder/cloud/commands/TapOnBack.yml

- runFlow:
    when:
      platform: iOS
    commands:
      - tapOn: 'Revenir à pass Culture S'
      - scrollUntilVisible:
          element:
            text: 'Instagram'

- tapOn: 'Tiktok'
- waitForAnimationToEnd
- runFlow:
    when:
      platform: Android
    commands:
      - assertVisible:
          id: 'com.android.chrome:id/url_bar'
      - pressKey: back
      - pressKey: back

- runFlow:
    when:
      platform: iOS
    commands:
      - tapOn: 'Revenir à pass Culture S'
      - scrollUntilVisible:
          element:
            text: 'Instagram'

- runFlow: # Fallback si problème de retour
    when:
      visible: 'Bonjour Test-e2e.*'
    commands:
      - tapOn: 'Mon profil.*'
      - scrollUntilVisible:
          element:
            text: 'Facebook'

- tapOn: 'Facebook'
- waitForAnimationToEnd
# - TODO: Investiguer la 429 à l'ouverture du lien externe
# - tapOn: "Fermer"
# - assertVisible:
#     text: "Pass Culture"
#     index: 1
- runFlow:
    when:
      platform: Android
    commands:
      - pressKey: back

- runFlow:
    when:
      platform: iOS
    commands:
      - tapOn: 'Revenir à pass Culture S'

- scrollUntilVisible:
    element:
      text: 'Paramètres du compte'
    direction: UP

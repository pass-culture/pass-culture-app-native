/**
 ⚠️ Design System — Protected file
 Do not edit this file without prior approval from the Design System team.
 */

import React, { FunctionComponent, useState } from 'react'
import styled from 'styled-components/native'

import { AccessibilityRole } from 'libs/accessibilityRole/accessibilityRole'
import { RadioButton } from 'ui/designSystem/RadioButton/RadioButton'
import { BaseRadioProps, Variant } from 'ui/designSystem/RadioButton/types'
import { SelectableSizing } from 'ui/designSystem/types'
import { ErrorFilled } from 'ui/svg/icons/ErrorFilled'
import { Typo } from 'ui/theme'

type RadioButtonGroupDisplay = 'horizontal' | 'vertical'

export type RadioButtonGroupOption = Omit<
  BaseRadioProps,
  'value' | 'setValue' | 'error' | 'variant' | 'disabled'
>

type Props = {
  label: string
  description: string
  options: Array<RadioButtonGroupOption>
  errorText: string
  error?: boolean
  variant?: Variant
  disabled?: boolean
  display?: RadioButtonGroupDisplay
}

export const RadioButtonGroup: FunctionComponent<Props> = ({
  label,
  description,
  options,
  errorText,
  error = false,
  variant = 'default',
  disabled = false,
  display = 'vertical',
}: Props) => {
  const [value, setValue] = useState('')
  return (
    <RadioButtonGroupContainer accessibilityRole={AccessibilityRole.GROUP}>
      <TitleContainer>
        <Typo.Body>{label}</Typo.Body>
        <Description>{description}</Description>
        {error ? (
          <ErrorContainer>
            <ErrorIcon />
            <ErrorText>{errorText}</ErrorText>
          </ErrorContainer>
        ) : null}
      </TitleContainer>
      <RadioButtonListContainer variant={variant} display={display}>
        {options.map((option) => (
          <RadioButton
            key={`rb-${option.label}`}
            label={option.label}
            disabled={disabled}
            error={error}
            value={value}
            setValue={
              disabled || value === option.label
                ? () => {
                    return
                  }
                : setValue
            }
            variant={variant}
            description={option.description}
            collapsed={option.collapsed}
            asset={option.asset}
            sizing={computedRadioButtonSizing(option.sizing, display)}
          />
        ))}
      </RadioButtonListContainer>
    </RadioButtonGroupContainer>
  )
}

const computedRadioButtonSizing = (
  sizing: SelectableSizing | undefined,
  display: RadioButtonGroupDisplay
) => {
  if (sizing) return sizing
  return display === 'horizontal' ? 'hug' : 'fill'
}

const RadioButtonGroupContainer = styled.View(({ theme }) => ({
  gap: theme.designSystem.size.spacing.s,
}))

const RadioButtonListContainer = styled.View<{
  variant: Variant
  display: RadioButtonGroupDisplay
}>(({ theme, variant, display }) => ({
  flexWrap: display === 'horizontal' ? 'wrap' : 'nowrap',
  flexDirection: display === 'vertical' ? 'column' : 'row',
  gap:
    variant == 'default' || display === 'horizontal'
      ? theme.designSystem.size.spacing.xl
      : theme.designSystem.size.spacing.s,
}))

const ErrorContainer = styled.View(({ theme }) => ({
  display: 'flex',
  flexDirection: 'row',
  alignItems: 'center',
  gap: theme.designSystem.size.spacing.xs,
}))

const TitleContainer = styled.View(({ theme }) => ({
  gap: theme.designSystem.size.spacing.xs,
}))

const Description = styled(Typo.BodyXs)(({ theme }) => ({
  color: theme.designSystem.color.text.subtle,
}))

const ErrorText = styled(Typo.BodyXs)(({ theme }) => ({
  color: theme.designSystem.color.text.error,
}))

const ErrorIcon = styled(ErrorFilled).attrs(({ theme }) => ({
  size: theme.icons.sizes.extraSmall,
  color: theme.designSystem.color.icon.error,
}))``

/**
 ⚠️ Design System — Protected file
 Do not edit this file without prior approval from the Design System team.
 */

import type { Meta } from '@storybook/react-vite'
import { screen, userEvent } from '@storybook/testing-library'
import React, { ComponentProps, useState } from 'react'

import { VariantsTemplate, type Variants, type VariantsStory } from 'ui/storybook/VariantsTemplate'

import { SearchInput } from './SearchInput'

const meta: Meta<typeof SearchInput> = {
  title: 'design system/inputs/SearchInput',
  component: SearchInput,
}
export default meta

const StatefulSearchInput = (props: ComponentProps<typeof SearchInput>) => {
  const [value, setValue] = useState<string>(typeof props.value === 'string' ? props.value : '')

  const handleChangeText = (next: string) => {
    setValue(next)
    props.onChangeText?.(next)
  }

  return <SearchInput {...props} value={value} onChangeText={handleChangeText} />
}

const variants: Variants<typeof SearchInput> = [
  { label: 'Default', props: {} },
  {
    label: 'Hover',
    props: {
      testID: 'searchInput-hover',
    },
  },
  {
    label: 'Focus',
    props: {
      autoFocus: true,
      nativeAutoFocus: true,
      testID: 'searchInput-autofocus',
    },
  },
  { label: 'Error', props: { errorMessage: 'Error message' } },
  { label: 'Disabled', props: { disabled: true } },
]

export const SearchInput_AllVariants: VariantsStory<typeof SearchInput> = {
  name: 'SearchInput',
  render: (props) => (
    <VariantsTemplate
      variants={variants}
      Component={StatefulSearchInput}
      defaultProps={{
        ...props,
        label: 'Label',
        description: 'Format\u00a0: adresse@mail.com',
      }}
    />
  ),
  play: async () => {
    const focusInput = await screen.findByTestId('searchInput-autofocus')
    ;(focusInput as HTMLElement).focus()

    const hoverInput = await screen.findByTestId('searchInput-hover')
    await userEvent.hover(hoverInput)
  },
}

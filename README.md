# PassCulture

This project and readme have been auto generated by [react-native-make](https://github.com/bamlab/react-native-make)

## Getting Started

### Requirements

Make sure you have installed:

- Git
- XCode
- Android SDK
- node
  - yarn
  - react-native-cli
- ruby (ruby version >= 2.4.0)
  - `sudo apt-add-repository ppa:brightbox/ruby-ng && sudo apt-get update`
  - `sudo apt-get install ruby2.4`
  - bundler (`sudo gem install bundler`)
- transcrypt (`brew install transcrypt`)

### Installation

```bash
git clone git@github.com:bamlab/project-name.git
cd project-name
bundle install
yarn
bundle exec pod repo update
cd ios && bundle exec pod install && cd ..
```

### Run the app

Launch the app in your simulator:

- iOS: `react-native run-ios --scheme PassCulture-Staging`
- Android: `react-native run-android --variant=stagingDebug`

## Features

When you generated the repository with [react-native-make](https://github.com/bamlab/react-native-make) the following feature must be present:

- A repository should have been created at https://github.com/bamlab/project-name
- An application have been created and deployed on appcenter
- You can deploy automatically with fastlane to appcenter
- You can deploy with codepush to staging too
- We installed the following libraries for you:
  - @react-native-community/async-storage
  - react-native-localize
  - lingui-js
  - typesafe-actions
  - jest
  - prettier
  - eslint

## Finding specific features location

To find where a feature is installed / used, run a search on the whole project using the tag

| Name             | Â Tag              |
| ---------------- | ----------------- |
| Translations     | @translations     |
| React Navigation | @react-navigation |
| CodePush         | @codepush         |

## Testing

You can run the tests with `yarn test`. This command will:

- Run `eslint` on your project
- Check the typescript types
- Run the `jest` tests

You can run the jest tests in watch mode with:

```bash
yarn jest --watch
```

You can also get the coverage with:

```bash
yarn jest --coverage
```

## Automatic generation

You can automatically generate files by running the following commands:

- `yarn plop atom` : generate an empty atom
- `yarn plop page` : generate an empty page

## Deploy

### Manual deploy for the moment => will be automated by ticket 4558

You can find the testing app at:

- https://appcenter.ms/orgs/pass-Culture/apps/passculture-<ENV:testing|staging>-ios
- https://appcenter.ms/orgs/pass-Culture/apps/passculture-<ENV:testing|staging>-android

#### Soft deploy

Pre-requisites :

- run `appcenter login` and connectwith your passculture email address
- get CODEPUSH_KEY_ANDROID, put it in `.env.{ENV}`
- comment lines 75 and 77 (git status and check_environment) of scripts/deploy, as you will have local changes since deploy is manual for the moment

Then run:

```
./scripts/deploy.sh -o android
```

> Only android working for the moment

> Default env is testing, no need to specify it in the command

#### Hard deploy (if I modified native code)

Pre-requisites:

- get testing.keystore file, put it in `android/keystores` folder
- get the keystore password, put it in `android/keystores/{ENV}.keystore.properties`
- get the Appcenter API token, you will be asked for it
- comment lines 75 and 77 (git status and check_environment) of scripts/deploy, as you will have local changes since deploy is manual for the moment

To deploy in testing environment, just run

```
./scripts/deploy.sh -t hard -o android
```

> Only android working for the moment

> Default env is testing, no need to specify it in the command

### CodePush

Most of the time, on staging, you didn't change anything in the native code. If you changed only javascript code, you can run:

```
./scripts/deploy.sh
```

Then the build should be faster as only the javascript code have been published.

To download updates from the application, just open it and click on the "check update" button.

## Troubleshooting

### Android: No value has been specified for property 'manifestOutputDirectory'.

In Android Studio: File > Settings > Experimental > Gradle -> uncheck "Only sync the active variant" checkbox.

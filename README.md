# PassCulture

This project and readme have been auto generated by [react-native-make](https://github.com/bamlab/react-native-make)

## Getting Started

### Requirements

Make sure you have installed:

- Git
- XCode
- Android SDK
- node
  - yarn
  - react-native-cli
- ruby (ruby version >= 2.4.0) 
  - `sudo apt-add-repository ppa:brightbox/ruby-ng && sudo apt-get update`
  - `sudo apt-get install ruby2.4`
  - bundler (`sudo gem install bundler`)
- transcrypt (`brew install transcrypt`)

### Installation

```bash
git clone git@github.com:bamlab/project-name.git
cd project-name
bundle install
yarn
bundle exec pod repo update
cd ios && bundle exec pod install && cd ..
```

### Configuration

Ask the password to a BAM's architect.

```
transcrypt -c aes-256-cbc -p '<password>'
```

### Run the app

Launch the app in your simulator:

- iOS: `react-native run-ios --scheme PassCulture-Staging`
- Android: `react-native run-android --variant=stagingDebug`

## Features

When you generated the repository with [react-native-make](https://github.com/bamlab/react-native-make) the following feature must be present:

- A repository should have been created at https://github.com/bamlab/project-name
- An application have been created and deployed on appcenter
- You can deploy automatically with fastlane to appcenter
- You can deploy with codepush to staging too
- We installed the following libraries for you:
  - @react-native-community/async-storage
  - react-native-localize
  - lingui-js
  - typesafe-actions
  - jest
  - prettier
  - eslint

## Finding specific features location

To find where a feature is installed / used, run a search on the whole project using the tag

| Name             | Â Tag              |
| ---------------- | ----------------- |
| Translations     | @translations     |
| React Navigation | @react-navigation |
| CodePush         | @codepush         |

## Testing

You can run the tests with `yarn test`. This command will:

- Run `eslint` on your project
- Check the typescript types
- Run the `jest` tests

You can run the jest tests in watch mode with:

```bash
yarn jest --watch
```

You can also get the coverage with:

```bash
yarn jest --coverage
```

## Automatic generation

You can automatically generate files by running the following commands:

- `yarn plop atom` : generate an empty atom
- `yarn plop page` : generate an empty page

## Deploy

A staging environment have been created for you. This environment push the application on Appcenter.

You can find the pushed app at:

- https://appcenter.ms/orgs/BAM.tech/apps/passculture-staging-ios
- https://appcenter.ms/orgs/BAM.tech/apps/passculture-staging-android/

To deploy in staging, just run

```
./scripts/deploy.sh -t hard
```

There is few options on the deploy command. Please run the following command to have all usages:

```
./scripts/deploy.sh -h
```

### CodePush

Most of the time, on staging, you didn't change anything in the native code. If you changed only javascript code, you can run:

```
./scripts/deploy.sh
```

Then the build should be faster as only the javascript code have been published.

To download updates from the application, just open it and click on the "check update" button.

## Troubleshooting

### Android: No value has been specified for property 'manifestOutputDirectory'.

In Android Studio: File > Settings > Experimental > Gradle -> uncheck "Only sync the active variant" checkbox.
